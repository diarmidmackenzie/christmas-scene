<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Winter Wonderland Christmas Playground</title>
    <meta name="description" content="Merry Christmas 2021!">
    {% include "scripts.html" %}
    <script src="./bundle.js"></script>
  </head>
  <body>
    <a-scene physics="driver: ammo"
            count-painted-snowballs
            check-for-present-stack
            tune-detector
            networking>
      <a-assets>
        {% include "templates.html" %}
        {% include "assets.html" %}
        {% include "mixins.html" %}
      </a-assets>

      {% include "environment.html" %}
      {% include "rig.html" %}

      <a-entity id="play-area">
        {% include "layout/snowman.html" %}
        {% include "layout/fence.html" %}
        {% include "layout/tree.html" %}
        {% include "layout/presents.html" %}
        {% include "layout/xylophone.html" %}
        {% include "layout/marble-run.html" %}
        {% include "layout/bowling.html" %}
        {% include "layout/blocks.html" %}
        {% include "layout/task-board.html" %}
        {% include "layout/floor.html" %}
      </a-entity>
    </a-scene>
    <script>

      // Called by Networked-Aframe when connected to server
      function onConnect() {
        console.log('onConnect', new Date());

        NAF.connection.adapter.enableMicrophone(true)
      }

      document.body.addEventListener('clientConnected', function (evt) {
        console.log('clientConnected event. clientId =', evt.detail.clientId);
        // Although NAF already makes a call to `NAF.entities.completeSync()`
        // on client connection, this doesn't seem to trigger replication of 
        // all entities.  This second call seems to be required.
        // Not fully understood why...
        NAF.entities.completeSync(evt.detail.clientId, false)
      });
    </script>
  </body>
</html>
